<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database Documentation - DigiMenu System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .content {
            padding: 40px;
        }
        
        .section {
            margin-bottom: 50px;
        }
        
        .section-title {
            font-size: 2em;
            color: #667eea;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }
        
        .table-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 30px;
            border-left: 5px solid #667eea;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .table-name {
            font-size: 1.5em;
            color: #764ba2;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .table-purpose {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #2196F3;
        }
        
        .columns-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .columns-table th {
            background: #667eea;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }
        
        .columns-table td {
            padding: 12px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .columns-table tr:hover {
            background: #f5f5f5;
        }
        
        .flow-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .flow-title {
            font-size: 1.4em;
            margin-bottom: 15px;
            font-weight: bold;
        }
        
        .flow-steps {
            background: rgba(255,255,255,0.2);
            padding: 20px;
            border-radius: 8px;
        }
        
        .flow-step {
            margin-bottom: 15px;
            padding-left: 30px;
            position: relative;
        }
        
        .flow-step:before {
            content: "‚Üí";
            position: absolute;
            left: 0;
            font-size: 1.5em;
            font-weight: bold;
        }
        
        .badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            margin-right: 5px;
        }
        
        .badge-primary {
            background: #667eea;
            color: white;
        }
        
        .badge-success {
            background: #4caf50;
            color: white;
        }
        
        .badge-warning {
            background: #ff9800;
            color: white;
        }
        
        .badge-danger {
            background: #f44336;
            color: white;
        }
        
        .note {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        
        .important {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            color: #721c24;
        }
        
        .toc {
            background: #e8eaf6;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        
        .toc h3 {
            color: #667eea;
            margin-bottom: 15px;
        }
        
        .toc ul {
            list-style: none;
        }
        
        .toc li {
            padding: 8px 0;
            border-bottom: 1px solid #c5cae9;
        }
        
        .toc a {
            color: #764ba2;
            text-decoration: none;
            font-weight: 500;
        }
        
        .toc a:hover {
            color: #667eea;
        }
        
        @media print {
            body {
                background: white;
                padding: 0;
            }
            .container {
                box-shadow: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üçΩÔ∏è DigiMenu Database Documentation</h1>
            <p>Complete Database Structure aur Data Flow Guide (Hinglish)</p>
            <p style="font-size: 0.9em; margin-top: 10px;">Restaurant Management System - PostgreSQL Database</p>
        </div>
        
        <div class="content">
            <!-- Table of Contents -->
            <div class="toc">
                <h3>üìë Table of Contents</h3>
                <ul>
                    <li><a href="#overview">1. System Overview</a></li>
                    <li><a href="#tables">2. Database Tables</a></li>
                    <li><a href="#flows">3. Data Flow Examples</a></li>
                    <li><a href="#relationships">4. Table Relationships</a></li>
                </ul>
            </div>

            <!-- Overview Section -->
            <div class="section" id="overview">
                <h2 class="section-title">üìä System Overview</h2>
                <div class="table-card">
                    <h3>DigiMenu System Kya Hai?</h3>
                    <p><strong>DigiMenu</strong> ek complete restaurant management system hai jo customers ko online menu browse karne, order place karne, aur payment karne ki facility deta hai. Admin panel se restaurant staff orders manage kar sakte hain.</p>
                    
                    <div class="note">
                        <strong>üîß Technology Stack:</strong>
                        <ul style="margin-top: 10px;">
                            <li><strong>Database:</strong> PostgreSQL</li>
                            <li><strong>Backend:</strong> Node.js + Express.js</li>
                            <li><strong>Authentication:</strong> OTP-based (MessageCentral API)</li>
                            <li><strong>Payment:</strong> Razorpay Integration</li>
                            <li><strong>Image Storage:</strong> Bunny CDN</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Tables Section -->
            <div class="section" id="tables">
                <h2 class="section-title">üóÑÔ∏è Database Tables</h2>
                
                <!-- Customers Table -->
                <div class="table-card">
                    <div class="table-name">1. customers</div>
                    <div class="table-purpose">
                        <strong>üìù Purpose:</strong> Restaurant ke customers ki information store karta hai. Jab koi user register karta hai tab entry banti hai.
                    </div>
                    
                    <table class="columns-table">
                        <thead>
                            <tr>
                                <th>Column Name</th>
                                <th>Data Type</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="badge badge-primary">customer_id</span></td>
                                <td>SERIAL PRIMARY KEY</td>
                                <td>Unique ID har customer ke liye (auto-increment)</td>
                            </tr>
                            <tr>
                                <td>name</td>
                                <td>VARCHAR(100)</td>
                                <td>Customer ka naam (registration time pe diya jata hai)</td>
                            </tr>
                            <tr>
                                <td>phone</td>
                                <td>VARCHAR(15) UNIQUE</td>
                                <td>Mobile number (10 digits, login ke liye use hota hai)</td>
                            </tr>
                            <tr>
                                <td>dob</td>
                                <td>DATE (nullable)</td>
                                <td>Date of Birth (birthday offers ke liye, optional)</td>
                            </tr>
                            <tr>
                                <td>created_at</td>
                                <td>TIMESTAMP</td>
                                <td>Registration date aur time (IST timezone)</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div class="note">
                        <strong>üí° Important:</strong> Phone number unique hona chahiye. Ek phone number se sirf ek account ban sakta hai.
                    </div>
                </div>

                <!-- Sessions Table -->
                <div class="table-card">
                    <div class="table-name">2. sessions</div>
                    <div class="table-purpose">
                        <strong>üìù Purpose:</strong> Customer login sessions ko track karta hai. Jab user login karta hai tab session create hota hai aur cookie me session_id store hoti hai.
                    </div>
                    
                    <table class="columns-table">
                        <thead>
                            <tr>
                                <th>Column Name</th>
                                <th>Data Type</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="badge badge-primary">session_id</span></td>
                                <td>VARCHAR(64) PRIMARY KEY</td>
                                <td>Unique session identifier (64 character hex string)</td>
                            </tr>
                            <tr>
                                <td><span class="badge badge-warning">customer_id</span></td>
                                <td>INTEGER FOREIGN KEY</td>
                                <td>Kis customer ka session hai (customers table se link)</td>
                            </tr>
                            <tr>
                                <td>ip_address</td>
                                <td>VARCHAR(45)</td>
                                <td>User ka IP address (security tracking ke liye)</td>
                            </tr>
                            <tr>
                                <td>user_agent</td>
                                <td>TEXT</td>
                                <td>Browser/device information</td>
                            </tr>
                            <tr>
                                <td>expires_at</td>
                                <td>TIMESTAMP</td>
                                <td>Session kab expire hoga (90 days validity)</td>
                            </tr>
                            <tr>
                                <td>last_activity</td>
                                <td>TIMESTAMP</td>
                                <td>Last activity time (auto-update hota hai)</td>
                            </tr>
                            <tr>
                                <td>created_at</td>
                                <td>TIMESTAMP</td>
                                <td>Session creation time</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div class="important">
                        <strong>‚ö†Ô∏è Security Note:</strong> Ek customer ka sirf ek active session ho sakta hai. Naya login karne par purana session delete ho jata hai.
                    </div>
                </div>

                <!-- Admins Table -->
                <div class="table-card">
                    <div class="table-name">3. admins</div>
                    <div class="table-purpose">
                        <strong>üìù Purpose:</strong> Restaurant ke admin/staff accounts store karta hai. Admin panel access ke liye credentials.
                    </div>
                    
                    <table class="columns-table">
                        <thead>
                            <tr>
                                <th>Column Name</th>
                                <th>Data Type</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="badge badge-primary">admin_id</span></td>
                                <td>SERIAL PRIMARY KEY</td>
                                <td>Unique admin ID</td>
                            </tr>
                            <tr>
                                <td>name</td>
                                <td>VARCHAR(100)</td>
                                <td>Admin ka naam (optional)</td>
                            </tr>
                            <tr>
                                <td>username</td>
                                <td>VARCHAR(50) UNIQUE</td>
                                <td>Login username (unique hona chahiye)</td>
                            </tr>
                            <tr>
                                <td>email</td>
                                <td>VARCHAR(100) UNIQUE</td>
                                <td>Email address (optional, unique)</td>
                            </tr>
                            <tr>
                                <td>password</td>
                                <td>VARCHAR(64)</td>
                                <td>SHA256 hashed password (plain text nahi store hota)</td>
                            </tr>
                            <tr>
                                <td>is_order_accept</td>
                                <td>BOOLEAN</td>
                                <td>Orders accept ho rahe hain ya nahi (toggle switch)</td>
                            </tr>
                            <tr>
                                <td>created_at</td>
                                <td>TIMESTAMP</td>
                                <td>Admin account creation time</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div class="note">
                        <strong>üí° Admin Session:</strong> Admin sessions database me nahi, signed cookies me store hote hain (90 days validity).
                    </div>
                </div>

                <!-- Menu Category Table -->
                <div class="table-card">
                    <div class="table-name">4. menu_category</div>
                    <div class="table-purpose">
                        <strong>üìù Purpose:</strong> Menu items ko categories me organize karne ke liye. Example: Starters, Main Course, Desserts, Beverages.
                    </div>
                    
                    <table class="columns-table">
                        <thead>
                            <tr>
                                <th>Column Name</th>
                                <th>Data Type</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="badge badge-primary">category_id</span></td>
                                <td>SERIAL PRIMARY KEY</td>
                                <td>Unique category ID</td>
                            </tr>
                            <tr>
                                <td>category_name</td>
                                <td>VARCHAR(100) UNIQUE</td>
                                <td>Category ka naam (e.g., "Starters", "Main Course")</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div class="note">
                        <strong>üí° Usage:</strong> Admin panel se categories create/update/delete kar sakte hain. Category delete karne se pehle check hota hai ki koi item us category me hai ya nahi.
                    </div>
                </div>

                <!-- Menu Items Table -->
                <div class="table-card">
                    <div class="table-name">5. menu_items</div>
                    <div class="table-purpose">
                        <strong>üìù Purpose:</strong> Restaurant ke menu items (dishes) ki complete information. Customers ye items dekh kar order karte hain.
                    </div>
                    
                    <table class="columns-table">
                        <thead>
                            <tr>
                                <th>Column Name</th>
                                <th>Data Type</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="badge badge-primary">item_id</span></td>
                                <td>SERIAL PRIMARY KEY</td>
                                <td>Unique item ID</td>
                            </tr>
                            <tr>
                                <td>item_name</td>
                                <td>VARCHAR(200)</td>
                                <td>Dish ka naam (e.g., "Paneer Butter Masala")</td>
                            </tr>
                            <tr>
                                <td><span class="badge badge-warning">category_id</span></td>
                                <td>INTEGER FOREIGN KEY</td>
                                <td>Kis category me hai (menu_category table se link)</td>
                            </tr>
                            <tr>
                                <td>price</td>
                                <td>DECIMAL(10,2)</td>
                                <td>Item ki price (rupees me)</td>
                            </tr>
                            <tr>
                                <td>image_url</td>
                                <td>TEXT</td>
                                <td>Bunny CDN se image URL (dish ki photo)</td>
                            </tr>
                            <tr>
                                <td>description</td>
                                <td>TEXT</td>
                                <td>Item ki description (optional)</td>
                            </tr>
                            <tr>
                                <td>is_available</td>
                                <td>BOOLEAN</td>
                                <td>Item available hai ya out of stock (default: true)</td>
                            </tr>
                            <tr>
                                <td>created_at</td>
                                <td>TIMESTAMP</td>
                                <td>Item kab add kiya gaya</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div class="important">
                        <strong>‚ö†Ô∏è Delete Restriction:</strong> Agar item kisi order me use hua hai to delete nahi kar sakte. Sirf is_available = false kar sakte hain.
                    </div>
                </div>

                <!-- Orders Table -->
                <div class="table-card">
                    <div class="table-name">6. orders</div>
                    <div class="table-purpose">
                        <strong>üìù Purpose:</strong> Customer orders ki main information. Har order ka unique ID, table number, total amount aur status.
                    </div>
                    
                    <table class="columns-table">
                        <thead>
                            <tr>
                                <th>Column Name</th>
                                <th>Data Type</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="badge badge-primary">order_id</span></td>
                                <td>SERIAL PRIMARY KEY</td>
                                <td>Unique order ID</td>
                            </tr>
                            <tr>
                                <td><span class="badge badge-warning">customer_id</span></td>
                                <td>INTEGER FOREIGN KEY</td>
                                <td>Kis customer ne order kiya (customers table se link)</td>
                            </tr>
                            <tr>
                                <td>table_number</td>
                                <td>VARCHAR(10)</td>
                                <td>Table number (e.g., "T-1", "T-2")</td>
                            </tr>
                            <tr>
                                <td>total_amount</td>
                                <td>DECIMAL(10,2)</td>
                                <td>Order ki total amount (all items ka sum)</td>
                            </tr>
                            <tr>
                                <td>status</td>
                                <td>VARCHAR(20)</td>
                                <td>Order status: pending, preparing, ready, completed, cancelled</td>
                            </tr>
                            <tr>
                                <td>created_at</td>
                                <td>TIMESTAMP</td>
                                <td>Order placement time (IST timezone)</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div class="note">
                        <strong>üí° Order Status Flow:</strong>
                        <ul style="margin-top: 10px;">
                            <li><strong>pending:</strong> Order placed, kitchen me nahi gaya</li>
                            <li><strong>preparing:</strong> Kitchen me preparation chal rahi hai</li>
                            <li><strong>ready:</strong> Order ready hai, customer ko serve karna hai</li>
                            <li><strong>completed:</strong> Order delivered aur completed</li>
                            <li><strong>cancelled:</strong> Order cancel ho gaya</li>
                        </ul>
                    </div>
                </div>

                <!-- Order Items Table -->
                <div class="table-card">
                    <div class="table-name">7. order_items</div>
                    <div class="table-purpose">
                        <strong>üìù Purpose:</strong> Har order me kaunse items hain aur kitni quantity me. Ek order me multiple items ho sakte hain.
                    </div>
                    
                    <table class="columns-table">
                        <thead>
                            <tr>
                                <th>Column Name</th>
                                <th>Data Type</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="badge badge-primary">order_item_id</span></td>
                                <td>SERIAL PRIMARY KEY</td>
                                <td>Unique order item ID</td>
                            </tr>
                            <tr>
                                <td><span class="badge badge-warning">order_id</span></td>
                                <td>INTEGER FOREIGN KEY</td>
                                <td>Kis order ka item hai (orders table se link)</td>
                            </tr>
                            <tr>
                                <td><span class="badge badge-warning">item_id</span></td>
                                <td>INTEGER FOREIGN KEY</td>
                                <td>Kaunsa menu item hai (menu_items table se link)</td>
                            </tr>
                            <tr>
                                <td>quantity</td>
                                <td>INTEGER</td>
                                <td>Kitni quantity order ki hai (e.g., 2 plates)</td>
                            </tr>
                            <tr>
                                <td>price</td>
                                <td>DECIMAL(10,2)</td>
                                <td>Order time pe item ki price (price change ho sakti hai future me)</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div class="note">
                        <strong>üí° Why Price Stored:</strong> Menu item ki price future me change ho sakti hai, isliye order time ki price yahan store karte hain.
                    </div>
                </div>

                <!-- Payments Table -->
                <div class="table-card">
                    <div class="table-name">8. payments</div>
                    <div class="table-purpose">
                        <strong>üìù Purpose:</strong> Order payments ki information. Cash ya Razorpay online payment, dono track hota hai.
                    </div>
                    
                    <table class="columns-table">
                        <thead>
                            <tr>
                                <th>Column Name</th>
                                <th>Data Type</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="badge badge-primary">payment_id</span></td>
                                <td>SERIAL PRIMARY KEY</td>
                                <td>Unique payment ID</td>
                            </tr>
                            <tr>
                                <td><span class="badge badge-warning">order_id</span></td>
                                <td>INTEGER FOREIGN KEY</td>
                                <td>Kis order ka payment hai (orders table se link)</td>
                            </tr>
                            <tr>
                                <td>amount</td>
                                <td>DECIMAL(10,2)</td>
                                <td>Payment amount (order total_amount ke equal)</td>
                            </tr>
                            <tr>
                                <td>payment_status</td>
                                <td>VARCHAR(20)</td>
                                <td>Status: pending, completed, failed</td>
                            </tr>
                            <tr>
                                <td>payment_method</td>
                                <td>VARCHAR(20)</td>
                                <td>Method: cash, razorpay</td>
                            </tr>
                            <tr>
                                <td>razorpay_payment_id</td>
                                <td>VARCHAR(100)</td>
                                <td>Razorpay transaction ID (online payment ke liye)</td>
                            </tr>
                            <tr>
                                <td>created_at</td>
                                <td>TIMESTAMP</td>
                                <td>Payment record creation time</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div class="important">
                        <strong>‚ö†Ô∏è Important:</strong> Har order ke liye payment record banta hai. Default status "pending" aur method "cash" hota hai. Online payment me Razorpay ID store hoti hai.
                    </div>
                </div>

                <!-- Ratings Table -->
                <div class="table-card">
                    <div class="table-name">9. ratings</div>
                    <div class="table-purpose">
                        <strong>üìù Purpose:</strong> Customer reviews aur ratings. Customer menu items ya orders ko rate kar sakte hain (1-5 stars).
                    </div>
                    
                    <table class="columns-table">
                        <thead>
                            <tr>
                                <th>Column Name</th>
                                <th>Data Type</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="badge badge-primary">rating_id</span></td>
                                <td>SERIAL PRIMARY KEY</td>
                                <td>Unique rating ID</td>
                            </tr>
                            <tr>
                                <td><span class="badge badge-warning">customer_id</span></td>
                                <td>INTEGER FOREIGN KEY</td>
                                <td>Kis customer ne rating di (customers table se link)</td>
                            </tr>
                            <tr>
                                <td>rating_value</td>
                                <td>INTEGER (1-5)</td>
                                <td>Rating value: 1 (worst) to 5 (best) stars</td>
                            </tr>
                            <tr>
                                <td>review_text</td>
                                <td>TEXT (nullable)</td>
                                <td>Written review/feedback (optional)</td>
                            </tr>
                            <tr>
                                <td><span class="badge badge-warning">item_id</span></td>
                                <td>INTEGER FOREIGN KEY (nullable)</td>
                                <td>Agar specific item ko rate kiya (menu_items se link)</td>
                            </tr>
                            <tr>
                                <td><span class="badge badge-warning">order_id</span></td>
                                <td>INTEGER FOREIGN KEY (nullable)</td>
                                <td>Agar complete order ko rate kiya (orders se link)</td>
                            </tr>
                            <tr>
                                <td>created_at</td>
                                <td>TIMESTAMP</td>
                                <td>Rating submission time</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div class="important">
                        <strong>‚ö†Ô∏è Rating Rules:</strong>
                        <ul style="margin-top: 10px;">
                            <li>Customer sirf completed orders ke items ko rate kar sakta hai</li>
                            <li>Ek customer ek item ko sirf ek baar rate kar sakta hai</li>
                            <li>item_id YA order_id me se ek hona chahiye (dono NULL nahi ho sakte)</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Data Flow Section -->
            <div class="section" id="flows">
                <h2 class="section-title">üîÑ Data Flow Examples</h2>
                <p style="margin-bottom: 20px;">Yahan real-world scenarios me data kaise flow hota hai, step-by-step samjhenge:</p>

                <!-- Flow 1: Customer Registration -->
                <div class="flow-card">
                    <div class="flow-title">üÜï Flow 1: Customer Registration (Naya User)</div>
                    <div class="flow-steps">
                        <div class="flow-step"><strong>Step 1:</strong> Customer frontend pe phone number aur name enter karta hai</div>
                        <div class="flow-step"><strong>Step 2:</strong> POST /api/auth/send-otp ‚Üí Backend MessageCentral API se OTP bhejta hai</div>
                        <div class="flow-step"><strong>Step 3:</strong> OTP in-memory store (Map) me temporarily save hota hai (10 min validity)</div>
                        <div class="flow-step"><strong>Step 4:</strong> Customer OTP enter karta hai</div>
                        <div class="flow-step"><strong>Step 5:</strong> POST /api/auth/verify-otp ‚Üí Backend OTP verify karta hai</div>
                        <div class="flow-step"><strong>Step 6:</strong> <strong>Database:</strong> INSERT INTO customers (name, phone) ‚Üí Naya customer entry</div>
                        <div class="flow-step"><strong>Step 7:</strong> <strong>Database:</strong> INSERT INTO sessions ‚Üí Naya session create hota hai</div>
                        <div class="flow-step"><strong>Step 8:</strong> Session ID cookie me store hoti hai (90 days validity)</div>
                        <div class="flow-step"><strong>Step 9:</strong> Customer logged in ho jata hai, menu page pe redirect</div>
                    </div>
                </div>

                <!-- Flow 2: Customer Login -->
                <div class="flow-card">
                    <div class="flow-title">üîê Flow 2: Customer Login (Existing User)</div>
                    <div class="flow-steps">
                        <div class="flow-step"><strong>Step 1:</strong> Customer phone number enter karta hai</div>
                        <div class="flow-step"><strong>Step 2:</strong> POST /api/auth/send-otp ‚Üí Backend check karta hai phone number exist karta hai ya nahi</div>
                        <div class="flow-step"><strong>Step 3:</strong> <strong>Database:</strong> SELECT FROM customers WHERE phone = ? ‚Üí Customer exist hai</div>
                        <div class="flow-step"><strong>Step 4:</strong> OTP bheja jata hai aur in-memory store me save hota hai</div>
                        <div class="flow-step"><strong>Step 5:</strong> Customer OTP verify karta hai</div>
                        <div class="flow-step"><strong>Step 6:</strong> <strong>Database:</strong> DELETE FROM sessions WHERE customer_id = ? ‚Üí Purana session delete</div>
                        <div class="flow-step"><strong>Step 7:</strong> <strong>Database:</strong> INSERT INTO sessions ‚Üí Naya session create</div>
                        <div class="flow-step"><strong>Step 8:</strong> Session ID cookie me store, customer logged in</div>
                    </div>
                </div>

                <!-- Flow 3: Browse Menu -->
                <div class="flow-card">
                    <div class="flow-title">üçΩÔ∏è Flow 3: Menu Browse Karna (Public Access)</div>
                    <div class="flow-steps">
                        <div class="flow-step"><strong>Step 1:</strong> Customer menu page open karta hai</div>
                        <div class="flow-step"><strong>Step 2:</strong> GET /api/menu/categories ‚Üí Categories fetch karne ke liye</div>
                        <div class="flow-step"><strong>Step 3:</strong> <strong>Database:</strong> SELECT FROM menu_category ORDER BY category_name</div>
                        <div class="flow-step"><strong>Step 4:</strong> GET /api/menu/items ‚Üí Menu items fetch karne ke liye</div>
                        <div class="flow-step"><strong>Step 5:</strong> <strong>Database:</strong> SELECT FROM menu_items JOIN menu_category LEFT JOIN ratings</div>
                        <div class="flow-step"><strong>Step 6:</strong> Har item ke saath average rating aur rating count bhi aata hai</div>
                        <div class="flow-step"><strong>Step 7:</strong> Frontend pe items category-wise display hote hain with images</div>
                    </div>
                </div>

                <!-- Flow 4: Place Order with Cash -->
                <div class="flow-card">
                    <div class="flow-title">üíµ Flow 4: Order Place Karna (Cash Payment)</div>
                    <div class="flow-steps">
                        <div class="flow-step"><strong>Step 1:</strong> Customer items cart me add karta hai (frontend state me)</div>
                        <div class="flow-step"><strong>Step 2:</strong> Table number select karta hai (e.g., T-1)</div>
                        <div class="flow-step"><strong>Step 3:</strong> POST /api/orders/create ‚Üí Order create request</div>
                        <div class="flow-step"><strong>Step 4:</strong> <strong>Database:</strong> SELECT FROM orders WHERE table_number = ? AND status IN ('pending','preparing','ready') ‚Üí Table availability check</div>
                        <div class="flow-step"><strong>Step 5:</strong> Agar table occupied hai to error return</div>
                        <div class="flow-step"><strong>Step 6:</strong> <strong>Database Transaction START</strong></div>
                        <div class="flow-step"><strong>Step 7:</strong> <strong>Database:</strong> INSERT INTO orders (customer_id, table_number, total_amount, status='pending')</div>
                        <div class="flow-step"><strong>Step 8:</strong> <strong>Database:</strong> INSERT INTO order_items (har item ke liye)</div>
                        <div class="flow-step"><strong>Step 9:</strong> <strong>Database:</strong> INSERT INTO payments (payment_status='pending', payment_method='cash')</div>
                        <div class="flow-step"><strong>Step 10:</strong> <strong>Database Transaction COMMIT</strong></div>
                        <div class="flow-step"><strong>Step 11:</strong> Order success message, order ID return hota hai</div>
                    </div>
                </div>

                <!-- Flow 5: Place Order with Razorpay -->
                <div class="flow-card">
                    <div class="flow-title">üí≥ Flow 5: Order Place Karna (Online Payment - Razorpay)</div>
                    <div class="flow-steps">
                        <div class="flow-step"><strong>Step 1:</strong> Customer cart me items add karta hai aur "Pay Online" select karta hai</div>
                        <div class="flow-step"><strong>Step 2:</strong> POST /api/payments/create-razorpay-order ‚Üí Razorpay order create</div>
                        <div class="flow-step"><strong>Step 3:</strong> Razorpay API se order_id milta hai (payment gateway ke liye)</div>
                        <div class="flow-step"><strong>Step 4:</strong> Frontend pe Razorpay payment modal open hota hai</div>
                        <div class="flow-step"><strong>Step 5:</strong> Customer payment complete karta hai (card/UPI/netbanking)</div>
                        <div class="flow-step"><strong>Step 6:</strong> Razorpay payment_id aur signature return karta hai</div>
                        <div class="flow-step"><strong>Step 7:</strong> POST /api/orders/create-after-payment ‚Üí Order create with payment details</div>
                        <div class="flow-step"><strong>Step 8:</strong> Backend Razorpay signature verify karta hai (security check)</div>
                        <div class="flow-step"><strong>Step 9:</strong> <strong>Database Transaction START</strong></div>
                        <div class="flow-step"><strong>Step 10:</strong> <strong>Database:</strong> INSERT INTO orders (status='pending')</div>
                        <div class="flow-step"><strong>Step 11:</strong> <strong>Database:</strong> INSERT INTO order_items</div>
                        <div class="flow-step"><strong>Step 12:</strong> <strong>Database:</strong> INSERT INTO payments (payment_status='completed', payment_method='razorpay', razorpay_payment_id)</div>
                        <div class="flow-step"><strong>Step 13:</strong> <strong>Database Transaction COMMIT</strong></div>
                        <div class="flow-step"><strong>Step 14:</strong> Order success, payment completed</div>
                    </div>
                </div>

                <!-- Flow 6: Admin Order Management -->
                <div class="flow-card">
                    <div class="flow-title">üë®‚Äçüíº Flow 6: Admin Order Management (Kitchen/Status Update)</div>
                    <div class="flow-steps">
                        <div class="flow-step"><strong>Step 1:</strong> Admin login karta hai (username + password)</div>
                        <div class="flow-step"><strong>Step 2:</strong> POST /api/auth/admin/login ‚Üí Credentials verify</div>
                        <div class="flow-step"><strong>Step 3:</strong> <strong>Database:</strong> SELECT FROM admins WHERE username = ? AND password = SHA256(?)</div>
                        <div class="flow-step"><strong>Step 4:</strong> Admin session signed cookie me store (database me nahi)</div>
                        <div class="flow-step"><strong>Step 5:</strong> GET /api/admin/orders?view_type=active ‚Üí Active orders fetch</div>
                        <div class="flow-step"><strong>Step 6:</strong> <strong>Database:</strong> SELECT FROM orders JOIN customers LEFT JOIN payments WHERE status != 'completed'</div>
                        <div class="flow-step"><strong>Step 7:</strong> Har order ke liye order_items bhi fetch hote hain (JOIN menu_items)</div>
                        <div class="flow-step"><strong>Step 8:</strong> Admin order status change karta hai (pending ‚Üí preparing ‚Üí ready ‚Üí completed)</div>
                        <div class="flow-step"><strong>Step 9:</strong> PUT /api/admin/orders/:id/status ‚Üí Status update request</div>
                        <div class="flow-step"><strong>Step 10:</strong> <strong>Database:</strong> UPDATE orders SET status = ? WHERE order_id = ?</div>
                        <div class="flow-step"><strong>Step 11:</strong> Status updated, frontend real-time update hota hai</div>
                    </div>
                </div>

                <!-- Flow 7: Mark Payment as Paid -->
                <div class="flow-card">
                    <div class="flow-title">üí∞ Flow 7: Cash Payment Mark Karna (Counter Pe)</div>
                    <div class="flow-steps">
                        <div class="flow-step"><strong>Step 1:</strong> Customer counter pe cash payment karta hai</div>
                        <div class="flow-step"><strong>Step 2:</strong> Admin "Mark as Paid" button click karta hai</div>
                        <div class="flow-step"><strong>Step 3:</strong> PUT /api/admin/orders/:id/mark-paid ‚Üí Payment update request</div>
                        <div class="flow-step"><strong>Step 4:</strong> <strong>Database:</strong> UPDATE payments SET payment_status='completed', payment_method='cash' WHERE order_id = ?</div>
                        <div class="flow-step"><strong>Step 5:</strong> Payment status updated (orders table me koi change nahi)</div>
                        <div class="flow-step"><strong>Step 6:</strong> Admin panel me payment status "Completed" show hota hai</div>
                    </div>
                </div>

                <!-- Flow 8: Customer Rating -->
                <div class="flow-card">
                    <div class="flow-title">‚≠ê Flow 8: Item/Order Rating Dena</div>
                    <div class="flow-steps">
                        <div class="flow-step"><strong>Step 1:</strong> Customer profile page pe "Rate Items" section open karta hai</div>
                        <div class="flow-step"><strong>Step 2:</strong> GET /api/ratings/ordered-items ‚Üí Eligible items fetch</div>
                        <div class="flow-step"><strong>Step 3:</strong> <strong>Database:</strong> SELECT FROM orders JOIN order_items JOIN menu_items WHERE customer_id = ? AND status='completed'</div>
                        <div class="flow-step"><strong>Step 4:</strong> Sirf completed orders ke items show hote hain</div>
                        <div class="flow-step"><strong>Step 5:</strong> Customer item select karke rating (1-5 stars) aur review deta hai</div>
                        <div class="flow-step"><strong>Step 6:</strong> POST /api/ratings/submit-item ‚Üí Rating submit</div>
                        <div class="flow-step"><strong>Step 7:</strong> Backend validate karta hai: customer ne item order kiya hai ya nahi</div>
                        <div class="flow-step"><strong>Step 8:</strong> <strong>Database:</strong> SELECT FROM orders JOIN order_items WHERE customer_id = ? AND item_id = ? AND status='completed'</div>
                        <div class="flow-step"><strong>Step 9:</strong> Check karta hai: already rated hai ya nahi</div>
                        <div class="flow-step"><strong>Step 10:</strong> <strong>Database:</strong> INSERT INTO ratings (customer_id, rating_value, review_text, item_id)</div>
                        <div class="flow-step"><strong>Step 11:</strong> Rating saved, thank you message show hota hai</div>
                    </div>
                </div>

                <!-- Flow 9: Admin Menu Management -->
                <div class="flow-card">
                    <div class="flow-title">üìã Flow 9: Menu Item Add/Update Karna (Admin)</div>
                    <div class="flow-steps">
                        <div class="flow-step"><strong>Step 1:</strong> Admin menu management page open karta hai</div>
                        <div class="flow-step"><strong>Step 2:</strong> "Add New Item" button click karta hai</div>
                        <div class="flow-step"><strong>Step 3:</strong> Form fill karta hai: item name, category, price, description, image upload</div>
                        <div class="flow-step"><strong>Step 4:</strong> POST /api/admin/items (multipart/form-data with image)</div>
                        <div class="flow-step"><strong>Step 5:</strong> Backend image ko Bunny CDN pe upload karta hai</div>
                        <div class="flow-step"><strong>Step 6:</strong> Bunny CDN se image URL milta hai</div>
                        <div class="flow-step"><strong>Step 7:</strong> <strong>Database:</strong> INSERT INTO menu_items (item_name, category_id, price, image_url, description, is_available=true)</div>
                        <div class="flow-step"><strong>Step 8:</strong> Item successfully added, menu me show hone lagta hai</div>
                        <div class="flow-step"><strong>Step 9:</strong> Update ke liye: PUT /api/admin/items/:id (purani image delete, nayi upload)</div>
                        <div class="flow-step"><strong>Step 10:</strong> <strong>Database:</strong> UPDATE menu_items SET ... WHERE item_id = ?</div>
                    </div>
                </div>

                <!-- Flow 10: Sales Report -->
                <div class="flow-card">
                    <div class="flow-title">üìä Flow 10: Sales Report Generate Karna</div>
                    <div class="flow-steps">
                        <div class="flow-step"><strong>Step 1:</strong> Admin sales report page open karta hai</div>
                        <div class="flow-step"><strong>Step 2:</strong> Period select karta hai (today/week/month/all)</div>
                        <div class="flow-step"><strong>Step 3:</strong> GET /api/sales/stats/overview?period=today ‚Üí Overview stats</div>
                        <div class="flow-step"><strong>Step 4:</strong> <strong>Database:</strong> SELECT COUNT, SUM, AVG FROM orders WHERE DATE(created_at) = CURRENT_DATE</div>
                        <div class="flow-step"><strong>Step 5:</strong> GET /api/sales/stats/best-sellers?period=today ‚Üí Top selling items</div>
                        <div class="flow-step"><strong>Step 6:</strong> <strong>Database:</strong> SELECT item_name, SUM(quantity) FROM order_items JOIN orders GROUP BY item_id ORDER BY quantity DESC</div>
                        <div class="flow-step"><strong>Step 7:</strong> GET /api/sales/stats/payment-methods ‚Üí Cash vs Online breakdown</div>
                        <div class="flow-step"><strong>Step 8:</strong> <strong>Database:</strong> SELECT payment_method, SUM(amount) FROM payments JOIN orders GROUP BY payment_method</div>
                        <div class="flow-step"><strong>Step 9:</strong> GET /api/sales/stats/customers ‚Üí Top customers</div>
                        <div class="flow-step"><strong>Step 10:</strong> <strong>Database:</strong> SELECT customer_id, COUNT(orders), SUM(total_amount) FROM orders GROUP BY customer_id ORDER BY total_spent DESC</div>
                        <div class="flow-step"><strong>Step 11:</strong> Complete report charts aur tables me display hota hai</div>
                    </div>
                </div>
            </div>

            <!-- Relationships Section -->
            <div class="section" id="relationships">
                <h2 class="section-title">üîó Table Relationships (Foreign Keys)</h2>
                
                <div class="table-card">
                    <h3>Database Tables Kaise Connected Hain:</h3>
                    
                    <table class="columns-table">
                        <thead>
                            <tr>
                                <th>Parent Table</th>
                                <th>Child Table</th>
                                <th>Relationship</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>customers</strong></td>
                                <td>sessions</td>
                                <td>1 : Many</td>
                                <td>Ek customer ke multiple sessions ho sakte hain (different devices/times)</td>
                            </tr>
                            <tr>
                                <td><strong>customers</strong></td>
                                <td>orders</td>
                                <td>1 : Many</td>
                                <td>Ek customer multiple orders place kar sakta hai</td>
                            </tr>
                            <tr>
                                <td><strong>customers</strong></td>
                                <td>ratings</td>
                                <td>1 : Many</td>
                                <td>Ek customer multiple ratings de sakta hai</td>
                            </tr>
                            <tr>
                                <td><strong>menu_category</strong></td>
                                <td>menu_items</td>
                                <td>1 : Many</td>
                                <td>Ek category me multiple items ho sakte hain</td>
                            </tr>
                            <tr>
                                <td><strong>menu_items</strong></td>
                                <td>order_items</td>
                                <td>1 : Many</td>
                                <td>Ek item multiple orders me ho sakta hai</td>
                            </tr>
                            <tr>
                                <td><strong>menu_items</strong></td>
                                <td>ratings</td>
                                <td>1 : Many</td>
                                <td>Ek item ko multiple customers rate kar sakte hain</td>
                            </tr>
                            <tr>
                                <td><strong>orders</strong></td>
                                <td>order_items</td>
                                <td>1 : Many</td>
                                <td>Ek order me multiple items ho sakte hain</td>
                            </tr>
                            <tr>
                                <td><strong>orders</strong></td>
                                <td>payments</td>
                                <td>1 : 1</td>
                                <td>Har order ka ek payment record hota hai</td>
                            </tr>
                            <tr>
                                <td><strong>orders</strong></td>
                                <td>ratings</td>
                                <td>1 : Many</td>
                                <td>Ek order ko rate kiya ja sakta hai (optional)</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="table-card">
                    <h3>üîç Important Database Queries (Real Backend Se):</h3>
                    
                    <div class="note">
                        <strong>1. Active Orders Fetch (Admin Panel):</strong>
                        <pre style="background: white; padding: 15px; border-radius: 5px; overflow-x: auto; margin-top: 10px;">
SELECT o.order_id, o.table_number, o.total_amount, o.status, o.created_at,
       c.name as customer_name, c.phone as customer_phone,
       p.payment_status, p.payment_method
FROM orders o
INNER JOIN customers c ON o.customer_id = c.customer_id
LEFT JOIN payments p ON o.order_id = p.order_id
WHERE o.status != 'completed'
ORDER BY o.created_at DESC</pre>
                    </div>

                    <div class="note">
                        <strong>2. Menu Items with Ratings (Customer Menu):</strong>
                        <pre style="background: white; padding: 15px; border-radius: 5px; overflow-x: auto; margin-top: 10px;">
SELECT mi.item_id, mi.item_name, mi.price, mi.image_url,
       mc.category_name,
       COALESCE(ROUND(AVG(r.rating_value)::numeric, 1), 0) as avg_rating,
       COUNT(r.rating_id) as rating_count
FROM menu_items mi
INNER JOIN menu_category mc ON mi.category_id = mc.category_id
LEFT JOIN ratings r ON mi.item_id = r.item_id
WHERE mi.is_available = true
GROUP BY mi.item_id, mc.category_name
ORDER BY mc.category_name, mi.item_name</pre>
                    </div>

                    <div class="note">
                        <strong>3. Best Selling Items (Sales Report):</strong>
                        <pre style="background: white; padding: 15px; border-radius: 5px; overflow-x: auto; margin-top: 10px;">
SELECT i.item_name, mc.category_name,
       SUM(oi.quantity) as total_quantity_sold,
       SUM(oi.quantity * oi.price) as total_revenue
FROM order_items oi
INNER JOIN menu_items i ON oi.item_id = i.item_id
LEFT JOIN menu_category mc ON i.category_id = mc.category_id
INNER JOIN orders o ON oi.order_id = o.order_id
WHERE DATE(o.created_at) = CURRENT_DATE
GROUP BY i.item_id, i.item_name, mc.category_name
ORDER BY total_quantity_sold DESC
LIMIT 10</pre>
                    </div>

                    <div class="note">
                        <strong>4. Customer Order History (Profile Page):</strong>
                        <pre style="background: white; padding: 15px; border-radius: 5px; overflow-x: auto; margin-top: 10px;">
SELECT o.order_id, o.table_number, o.total_amount, o.status, o.created_at,
       p.payment_status, p.payment_method
FROM orders o
LEFT JOIN payments p ON o.order_id = p.order_id
WHERE o.customer_id = ?
ORDER BY o.created_at DESC
LIMIT 20</pre>
                    </div>
                </div>

                <div class="important">
                    <h3>‚ö†Ô∏è Critical Database Rules:</h3>
                    <ul style="margin-top: 10px; line-height: 2;">
                        <li><strong>Cascade Delete:</strong> Order delete karne se pehle order_items aur payments delete karne padte hain (foreign key constraint)</li>
                        <li><strong>Menu Item Delete:</strong> Agar item kisi order me use hua hai to delete nahi kar sakte, sirf is_available = false kar sakte hain</li>
                        <li><strong>Session Cleanup:</strong> Expired sessions automatically delete hote hain (background cleanup process)</li>
                        <li><strong>Table Availability:</strong> Ek table pe sirf ek active order (pending/preparing/ready) ho sakta hai</li>
                        <li><strong>Payment Integrity:</strong> Har order ke liye payment record mandatory hai (default: pending + cash)</li>
                        <li><strong>Rating Validation:</strong> Customer sirf completed orders ke items ko rate kar sakta hai</li>
                        <li><strong>Timezone:</strong> Sab timestamps IST (Asia/Kolkata) me store hote hain</li>
                    </ul>
                </div>
            </div>

            <!-- Summary Section -->
            <div class="section">
                <h2 class="section-title">üìù Summary</h2>
                <div class="table-card">
                    <h3>DigiMenu Database - Quick Overview:</h3>
                    <ul style="line-height: 2; margin-top: 15px;">
                        <li><strong>Total Tables:</strong> 9 (customers, sessions, admins, menu_category, menu_items, orders, order_items, payments, ratings)</li>
                        <li><strong>Authentication:</strong> OTP-based for customers, username/password for admins</li>
                        <li><strong>Session Management:</strong> Database sessions for customers, signed cookies for admins</li>
                        <li><strong>Payment Methods:</strong> Cash (counter pe) aur Razorpay (online)</li>
                        <li><strong>Order Flow:</strong> pending ‚Üí preparing ‚Üí ready ‚Üí completed</li>
                        <li><strong>Image Storage:</strong> Bunny CDN (menu items ke liye)</li>
                        <li><strong>Rating System:</strong> 1-5 stars, items aur orders dono ko rate kar sakte hain</li>
                        <li><strong>Reports:</strong> Sales, best sellers, payment methods, customer analytics</li>
                    </ul>
                </div>

                <div class="note">
                    <strong>üí° For Developers:</strong> Ye documentation actual backend code (routes/*.js files) se extract kiya gaya hai. Har table aur flow real production system me use ho raha hai. Koi assumed ya dummy data nahi hai.
                </div>

                <div class="important">
                    <strong>üéì For Students/Teachers:</strong> Ye documentation restaurant management system ka complete database structure explain karta hai. Aap isse reference ke liye use kar sakte hain aur samajh sakte hain ki real-world applications me database kaise design hota hai aur data kaise flow hota hai.
                </div>
            </div>

            <!-- Footer -->
            <div style="text-align: center; padding: 30px; background: #f8f9fa; border-top: 2px solid #e0e0e0; margin-top: 50px;">
                <p style="color: #666; font-size: 0.9em;">
                    üìÑ Database Documentation - DigiMenu System<br>
                    Generated from actual backend code (Node.js + PostgreSQL)<br>
                    Last Updated: December 2024
                </p>
            </div>
        </div>
    </div>
</body>
</html>
